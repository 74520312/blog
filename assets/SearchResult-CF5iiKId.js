import{i as V,l as W,m as X,p as Z,q as ee,s as ae,v as te,j as S,x as H,k as e,y as le,z as se,A as re,R as F,B as oe,C as ie,D as ne,E as ce,G as ue,H as $,I,J as de,K as me,L as ve,M as he,N as ye,O as pe,P as ge,Q as Ee,S as M,T as ke,U as A}from"./app-Bzqjd42B.js";const fe=["/","/document/","/document/intro.html","/document/daily/1.html","/document/daily/","/document/demo/1.html","/document/demo/","/document/demo/disable.html","/document/demo/encrypt.html","/document/demo/layout.html","/document/demo/markdown.html","/document/demo/page.html","/document/development/1.html","/document/development/","/document/maintenance/","/document/middleware/","/document/development/java/2.html","/document/development/java/","/document/development/java/java2.html","/document/development/java/java%E5%BC%80%E5%8F%91.html","/document/development/python/","/document/maintenance/docker/","/document/maintenance/linux/","/document/maintenance/openvpn/","/document/middleware/kafka/1%20copy.html","/document/middleware/kafka/1.html","/document/middleware/kafka/","/document/middleware/rabbitmq/","/document/middleware/redis/","/404.html","/category/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/%E8%8B%B9%E6%9E%9C/","/category/%E6%8C%87%E5%8D%97/","/tag/","/tag/%E7%BA%A2/","/tag/%E5%A4%A7/","/tag/%E5%9C%86%E3%80%81/","/tag/%E7%A6%81%E7%94%A8/","/tag/%E5%8A%A0%E5%AF%86/","/tag/%E5%B8%83%E5%B1%80/","/tag/markdown/","/tag/%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE/","/tag/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/article/","/star/","/timeline/"],we="SLIMSEARCH_QUERY_HISTORY",g=M(we,[]),He=()=>{const{queryHistoryCount:s}=A;return{enabled:s>0,queryHistories:g,addQueryHistory:n=>{g.value=Array.from(new Set([n,...g.value.slice(0,s-1)]))},removeQueryHistory:n=>{g.value=[...g.value.slice(0,n),...g.value.slice(n+1)]}}},q=s=>fe[s.id]+("anchor"in s?`#${s.anchor}`:""),Ae="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=A,E=M(Ae,[]),be=()=>({enabled:T>0,resultHistories:E,addResultHistory:i=>{{const n={link:q(i),display:i.display};"header"in i&&(n.header=i.header),E.value=[n,...E.value.slice(0,T-1)]}},removeResultHistory:i=>{E.value=[...E.value.slice(0,i),...E.value.slice(i+1)]}}),xe=s=>{const{page:i,routeLocale:n}=de(),b=me(),r=S(0),k=H(()=>r.value>0),d=ve([]);return he(()=>{const{search:x,terminate:h}=ye(),f=ge(y=>{const{resultsFilter:C=l=>l,querySplitter:p,suggestionsFilter:B,...o}=b.value;y?(r.value+=1,x(y,n.value,o).then(l=>C(l,y,n.value,i.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},A.searchDelay-A.suggestDelay,{maxWait:5e3});pe([s,n],([y])=>f(y.join(" "))),Ee(()=>{h()})}),{isSearching:k,results:d}};var De=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(s,{emit:i}){const n=W(),b=X(),r=Z(ee),{addQueryHistory:k,queryHistories:d,removeQueryHistory:x}=He(),{resultHistories:h,addResultHistory:f,removeResultHistory:y}=be(),C=ae(s,"queries"),{results:p,isSearching:B}=xe(C),o=te({isQuery:!0,index:0}),l=S(0),m=S(0),L=H(()=>d.value.length>0||h.value.length>0),D=H(()=>p.value.length>0),Q=H(()=>p.value[l.value]||null),U=()=>{const{isQuery:a,index:t}=o;t===0?(o.isQuery=!a,o.index=a?h.value.length-1:d.value.length-1):o.index=t-1},O=()=>{const{isQuery:a,index:t}=o;t===(a?d.value.length-1:h.value.length-1)?(o.isQuery=!a,o.index=0):o.index=t+1},P=()=>{l.value=l.value>0?l.value-1:p.value.length-1,m.value=Q.value.contents.length-1},_=()=>{l.value=l.value<p.value.length-1?l.value+1:0,m.value=0},Y=()=>{m.value<Q.value.contents.length-1?m.value+=1:_()},z=()=>{m.value>0?m.value-=1:P()},R=a=>a.map(t=>ke(t)?t:e(t[0],t[1])),G=a=>{if(a.type==="customField"){const t=ce[a.index]||"$content",[v,c=""]=ue(t)?t[b.value].split("$content"):t.split("$content");return a.display.map(u=>e("div",R([v,...u,c])))}return a.display.map(t=>e("div",R(t)))},w=()=>{l.value=0,m.value=0,i("updateQuery",""),i("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,t)=>{const v=o.isQuery&&o.index===t;return e("li",{class:["slimsearch-record-matches",{active:v}],role:"option","aria-selected":v,onClick:()=>{i("updateQuery",a)}},e("div",[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),x(t)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((a,t)=>{const v=!o.isQuery&&o.index===t;return e("li",{class:["slimsearch-record-matches",{active:v}],role:"option","aria-selected":v},e(F,{to:a.link,onClick:()=>{w()}},()=>[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(c=>R(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(t)}})]))}))]));return le("keydown",a=>{if(s.isFocusing){if(D.value){if(a.key==="ArrowUp")z();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const t=Q.value.contents[m.value];k(s.queries.join(" ")),f(t),n.push(q(t)),w()}}else if(a.key==="ArrowUp")U();else if(a.key==="ArrowDown")O();else if(a.key==="Enter"){const{index:t}=o;o.isQuery?(a.preventDefault(),i("updateQuery",d.value[t])):(n.push(h.value[t].link),w())}}}),se([l,m],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:s.queries.length?!D.value:!L.value}]},s.queries.length?B.value?e(re,{hint:r.value.searching}):D.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:a,contents:t},v)=>{const c=l.value===v;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},t.map((u,N)=>{const j=c&&m.value===N;return e("li",{class:["slimsearch-record-matches",{active:j}],role:"option","aria-selected":j},e(F,{to:q(u),onClick:()=>{k(s.queries.join(" ")),f(u),w()}},()=>[u.type==="text"?null:e(u.type==="title"?oe:u.type==="heading"?ie:ne,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[u.type==="text"&&u.header?e("div",{class:"slimsearch-record-content-header"},u.header):null,e("div",G(u))])]))}))])})):r.value.emptyResult:L.value?[J(),K()]:r.value.emptyHistory)}});export{De as default};
